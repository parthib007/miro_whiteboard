(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{1040:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[roomId]",function(){return n(955)}])},6724:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{r:function(){return i}});var o,i=function(e){if(Array.isArray(e))return r(e)}(o=Object.values({PURPLE:"#6B32F3",BLUE:"#408FF8",RED:"#F32D27",GREEN:"#6FCB12",GOLD:"#A89D6C",PINK:"#EB29DA",MINT:"#19CB87",RED_LIGHT:"#ED7878",CYAN:"#02CBF6",RED_DARK:"#BA1555",ORANGE:"#FF7300"}))||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()},2782:function(e,t,n){"use strict";n.d(t,{W:function(){return r}});var r=(0,n(3264).io)()},7541:function(e,t,n){"use strict";n.d(t,{NW:function(){return r.NW},u4:function(){return r.u4},bo:function(){return r.bo},av:function(){return r.av}});n(5875);var r=n(3290)},5875:function(e,t,n){"use strict";n.d(t,{p:function(){return o},X:function(){return i}});var r=n(2804),o={id:"",users:new Map,usersMoves:new Map,movesWithoutUser:[],myMoves:[]},i=(0,r.cn)({key:"room",default:o})},3290:function(e,t,n){"use strict";n.d(t,{av:function(){return b},NW:function(){return d},bb:function(){return m},u4:function(){return h},bo:function(){return v}});var r=n(2804),o=n(6724),i=n(5875);function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){u(e,t,n[t])}))}return e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||f(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||f(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){if(e){if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}var d=function(){return(0,r.sJ)(i.X)},m=function(){return(0,r.Zl)(i.X)},h=function(){var e=(0,r.Zl)(i.X);return function(t){e(c({},i.p,{id:t}))}},v=function(){var e=(0,r.Zl)(i.X);return{handleAddUser:function(t,n){e((function(e){var r,i=e.users,a=e.usersMoves,u=function(e){var t=o.r.findIndex((function(t){return t===e}));return-1===t?o.r[0]:o.r[(t+1)%o.r.length]}(null===(r=s(i.values()).pop())||void 0===r?void 0:r.color);return i.set(t,{name:n,color:u}),a.set(t,[]),c({},e,{users:i,usersMoves:a})}))},handleRemoveUser:function(t){e((function(e){var n=e.users,r=e.usersMoves,o=r.get(t);return n.delete(t),r.delete(t),c({},e,{users:n,usersMoves:r,movesWithoutUser:s(e.movesWithoutUser).concat(s(o||[]))})}))},handleAddMoveToUser:function(t,n){e((function(e){var r=e.usersMoves,o=e.usersMoves.get(t);return r.set(t,s(o||[]).concat([n])),c({},e,{usersMoves:r})}))},handleRemoveMoveFromUser:function(t){e((function(e){var n=e.usersMoves,r=e.usersMoves.get(t);return null===r||void 0===r||r.pop(),n.set(t,r||[]),c({},e,{usersMoves:n})}))}}},b=function(){var e=l((0,r.FV)(i.X),2),t=e[0],n=e[1];return{handleAddMyMove:function(e){n((function(t){var n;return"select"===(null===(n=t.myMoves[t.myMoves.length-1])||void 0===n?void 0:n.options.mode)?c({},t,{myMoves:s(t.myMoves.slice(0,t.myMoves.length-1)).concat([e])}):c({},t,{myMoves:s(t.myMoves).concat([e])})}))},handleRemoveMyMove:function(){var e=s(t.myMoves),r=e.pop();return n((function(t){return c({},t,{myMoves:e})})),r},myMoves:t.myMoves}}},100:function(e,t,n){"use strict";var r=n(5893),o=n(8193),i=n(1513);t.Z=function(e){var t=e.id,n=(0,i.d)().closeModal;return(0,r.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10 ",children:[(0,r.jsx)("button",{onClick:n,className:"absolute top-5 right-5",children:(0,r.jsx)(o.oHP,{})}),(0,r.jsxs)("h2",{className:"text-lg font-bold",children:['Room with id "',t,'" does not exist or is full!']}),(0,r.jsx)("h3",{children:"Try to join room later."})]})}},955:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Et}});var r=n(5893),o=n(7541),i=n(7294),a=n(4960),u=n(782),c=n(6724),l=n(2782),s=n(3290);function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var h=(0,i.createContext)(null),v=function(e){var t=e.children,n=(0,s.bb)(),f=(0,s.NW)().users,v=(0,o.bo)(),b=v.handleAddUser,y=v.handleRemoveUser,g=(0,i.useRef)(null),p=(0,i.useRef)(null),x=(0,i.useRef)(null),w=(0,i.useRef)(null),j=(0,i.useRef)(null),S=(0,i.useRef)([]),k=(0,i.useState)({base64:""}),E=k[0],O=k[1],N=(0,a.c)(0),A=(0,a.c)(0);return(0,i.useEffect)((function(){return l.W.on("room",(function(e,t,r){var o=new Map(JSON.parse(t)),i=new Map(JSON.parse(r)),a=new Map;i.forEach((function(e,t){if(t!==l.W.id){var n=m(i.keys()).indexOf(t),r=c.r[n%c.r.length];a.set(t,{name:e,color:r})}})),n((function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){d(e,t,n[t])}))}return e}({},t,{users:a,usersMoves:o,movesWithoutUser:e.drawed})}))})),l.W.on("new_user",(function(e,t){(0,u.Am)("".concat(t," has joined the room."),{position:"top-center",theme:"colored"}),b(e,t)})),l.W.on("user_disconnected",(function(e){var t;(0,u.Am)("".concat((null===(t=f.get(e))||void 0===t?void 0:t.name)||"Anonymous"," has left the room."),{position:"top-center",theme:"colored"}),y(e)})),function(){l.W.off("room"),l.W.off("new_user"),l.W.off("user_disconnected")}}),[b,y,n,f]),(0,r.jsx)(h.Provider,{value:{x:N,y:A,bgRef:w,undoRef:g,redoRef:p,canvasRef:x,setMoveImage:O,moveImage:E,minimapRef:j,selectionRefs:S},children:t})},b=n(3830),y=n(3750),g=4e3,p=2e3,x=function(){var e=(0,i.useState)(0),t=e[0],n=e[1],r=(0,i.useState)(0),o=r[0],a=r[1];return(0,i.useEffect)((function(){var e=function(){n(window.innerWidth),a(window.innerHeight)};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),{width:t,height:o}},w=function(){var e=(0,i.useContext)(h);return{x:e.x,y:e.y}},j=function(){var e=(0,i.useContext)(h),t=e.undoRef,n=e.bgRef,r=e.canvasRef,o=e.minimapRef;return{undoRef:t,redoRef:e.redoRef,bgRef:n,canvasRef:r,minimapRef:o,selectionRefs:e.selectionRefs}},S=function(){var e=j().canvasRef,t=(0,i.useState)(),n=t[0],r=t[1];return(0,i.useEffect)((function(){var t,n=null===(t=e.current)||void 0===t?void 0:t.getContext("2d");n&&(n.lineJoin="round",n.lineCap="round",r(n))}),[e]),n},k={circle:{cX:0,cY:0,radiusX:0,radiusY:0},rect:{width:0,height:0},path:[],options:{shape:"line",mode:"draw",lineWidth:1,lineColor:{r:0,g:0,b:0,a:0},fillColor:{r:0,g:0,b:0,a:0},selection:null},id:"",img:{base64:""},timestamp:0},E=function(e,t){return e-t.get()},O=function(e){return"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(e.a,")")},N=n(2804),A=(0,N.cn)({key:"options",default:{lineColor:{r:0,g:0,b:0,a:1},fillColor:{r:0,g:0,b:0,a:0},lineWidth:5,mode:"draw",shape:"line",selection:null}});function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C(e,t,n[t])}))}return e}var P=function(){return(0,N.sJ)(A)},I=function(){return(0,N.FV)(A)},R=function(){var e=(0,N.Zl)(A);return{setSelection:function(t){e((function(e){return M({},e,{selection:t})}))},clearSelection:function(){e((function(e){return M({},e,{selection:null})}))}}},W=(0,N.cn)({key:"saved_moves",default:[]});function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function L(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var D=function(){var e=(0,N.Zl)(W);return{addSavedMove:function(t){"select"!==t.options.mode&&e((function(e){return[t].concat(L(e))}))},removeSavedMove:function(){var t;return e((function(e){return t=e.at(0),e.slice(1)})),t},clearSavedMoves:function(){e([])}}},_=function(e,t,n,r){var o=e-n[0],i=t-n[1];return r?Math.abs(o)>Math.abs(i)?o=o>0&&i<0||o<0&&i>0?-i:i:i=i>0&&o<0||i<0&&o>0?-o:o:(o=e-n[0],i=t-n[1]),{width:o,height:i}},U=function(e,t,n,r,o,i){e.beginPath();var a=_(n,r,t,o),u=a.width,c=a.height;return i?e.fillRect(t[0],t[1],u,c):e.rect(t[0],t[1],u,c),e.stroke(),e.fill(),e.closePath(),{width:u,height:c}};function z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){z(e,t,n[t])}))}return e}var F,Y=[],Z={cX:0,cY:0,radiusX:0,radiusY:0},$={width:0,height:0},B=function(e){var t=P(),n=w(),r=D().clearSavedMoves,a=(0,o.av)().handleAddMyMove,u=R(),c=u.setSelection,s=u.clearSelection,f=n.x,d=n.y,m=(0,i.useState)(!1),h=m[0],v=m[1],b=S(),y=function(){b&&(b.lineWidth=t.lineWidth,b.strokeStyle=O(t.lineColor),b.fillStyle=O(t.fillColor),"eraser"===t.mode?b.globalCompositeOperation="destination-out":b.globalCompositeOperation="source-over")},g=function(){F||(F=null===b||void 0===b?void 0:b.getImageData(0,0,b.canvas.width,b.canvas.height)),F&&(null===b||void 0===b||b.putImageData(F,0,0))},p=function(){g(),F=void 0};return{handleEndDrawing:function(){if(b&&!e){v(!1),b.closePath();var n=!0;if("select"===t.mode&&Y.length){p();var o=Y[0][0],i=Y[0][1],u=Y[Y.length-1][0]-o,f=Y[Y.length-1][1]-i;u<0?(u-=4,o+=2):(u+=4,o-=2),f<0?(f-=4,i+=2):(f+=4,i-=2),(u<4||u>4)&&(f<4||f>4)?c({x:o,y:i,width:u,height:f}):(s(),n=!1)}var d=X({},k,{rect:X({},$),circle:X({},Z),path:Y,options:t});Y=[],Z={cX:0,cY:0,radiusX:0,radiusY:0},$={width:0,height:0},"select"!==t.mode?(l.W.emit("draw",d),r()):n&&a(d)}},handleDraw:function(n,r,o){if(b&&h&&!e){var i=[E(n,f),E(r,d)],a=i[0],u=i[1];if(g(),"select"===t.mode)return b.fillStyle="rgba(0, 0, 0, 0.2)",U(b,Y[0],a,u,!1,!0),Y.push([a,u]),void y();switch(t.shape){case"line":o&&(Y=Y.slice(0,1)),function(e,t,n,r,o){if(o)return e.beginPath(),e.lineTo(t[0],t[1]),e.lineTo(n,r),e.stroke(),void e.closePath();e.lineTo(n,r),e.stroke()}(b,Y[0],a,u,o),Y.push([a,u]);break;case"circle":Z=function(e,t,n,r,o){e.beginPath();var i=_(n,r,t,o),a=i.width,u=i.height,c=t[0]+a/2,l=t[1]+u/2,s=Math.abs(a/2),f=Math.abs(u/2);return e.ellipse(c,l,s,f,0,0,2*Math.PI),e.stroke(),e.fill(),e.closePath(),{cX:c,cY:l,radiusX:s,radiusY:f}}(b,Y[0],a,u,o);break;case"rect":$=U(b,Y[0],a,u,o)}}},handleStartDrawing:function(n,r){if(b&&!e&&!e){var o=[E(n,f),E(r,d)],i=o[0],a=o[1];v(!0),y(),g(),"line"===t.shape&&"select"!==t.mode&&(b.beginPath(),b.lineTo(i,a),b.stroke()),Y.push([i,a])}},drawing:h,clearOnYourMove:p}},J=n(4051),K=n.n(J),H=(0,N.cn)({key:"bg",default:{mode:"light",lines:!0}}),G=function(){var e=(0,N.sJ)(H);return(0,i.useEffect)((function(){var t=window.document.documentElement;"dark"===e.mode?(t.classList.remove("light"),t.classList.add("dark")):(t.classList.remove("dark"),t.classList.add("light"))}),[e.mode]),e},V=function(){var e=(0,i.useContext)(h);return{moveImage:e.moveImage,setMoveImage:e.setMoveImage}};function q(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function Q(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){q(i,r,o,a,u,"next",e)}function u(e){q(i,r,o,a,u,"throw",e)}a(void 0)}))}}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ee(e,t,n[t])}))}return e}var ne={x:0,y:0,width:0,height:0};function re(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function oe(e,t,n,r,o,i,a){try{var u=e[i](a),c=u.value}catch(l){return void n(l)}u.done?t(c):Promise.resolve(c).then(r,o)}function ie(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||ue(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ae(e){return function(e){if(Array.isArray(e))return re(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ue(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ue(e,t){if(e){if("string"===typeof e)return re(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?re(e,t):void 0}}var ce=0,le=function(e){var t=j(),n=t.canvasRef,r=t.minimapRef,a=t.bgRef,c=(0,o.NW)(),s=(0,o.av)(),f=s.handleAddMyMove,d=s.handleRemoveMyMove,m=D(),h=m.addSavedMove,v=m.removeSavedMove,b=S(),y=G(),g=R().clearSelection,p=(0,i.useMemo)((function(){var e,t=c.usersMoves,n=c.movesWithoutUser,r=c.myMoves,o=ae(n).concat(ae(r));return t.forEach((function(t){return(e=o).push.apply(e,ae(t))})),o.sort((function(e,t){return e.timestamp-t.timestamp})),o}),[c]),x=function(){if(n.current&&r.current&&a.current){var e=r.current.getContext("2d");e&&(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(a.current,0,0,e.canvas.width,e.canvas.height),e.drawImage(n.current,0,0,e.canvas.width,e.canvas.height))}};(0,i.useEffect)((function(){return x()}),[y]);var w=function(e,t){var n=e.path;if(b&&n.length){var r=e.options;if("select"!==r.mode){switch(b.lineWidth=r.lineWidth,b.strokeStyle=O(r.lineColor),b.fillStyle=O(r.fillColor),"eraser"===r.mode?b.globalCompositeOperation="destination-out":b.globalCompositeOperation="source-over","image"===r.shape&&t&&b.drawImage(t,n[0][0],n[0][1]),r.shape){case"line":b.beginPath(),n.forEach((function(e){var t=ie(e,2),n=t[0],r=t[1];b.lineTo(n,r)})),b.stroke(),b.closePath();break;case"circle":var o=e.circle,i=o.cX,a=o.cY,u=o.radiusX,c=o.radiusY;b.beginPath(),b.ellipse(i,a,u,c,0,0,2*Math.PI),b.stroke(),b.fill(),b.closePath();break;case"rect":var l=e.rect,s=l.width,f=l.height;b.beginPath(),b.rect(n[0][0],n[0][1],s,f),b.stroke(),b.fill(),b.closePath()}x()}}},E=function(){var e,t=(e=K().mark((function e(){var t;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=2;break}return e.abrupt("return");case 2:return b.clearRect(0,0,b.canvas.width,b.canvas.height),e.next=5,Promise.all(p.filter((function(e){return"image"===e.options.shape})).map((function(e){return new Promise((function(t){var n=new Image;n.src=e.img.base64,n.id=e.id,n.addEventListener("load",(function(){return t(n)}))}))})));case 5:t=e.sent,p.forEach((function(e){if("image"===e.options.shape){var n=t.find((function(t){return t.id===e.id}));n&&w(e,n)}else w(e)})),x();case 8:case"end":return e.stop()}}),e)})),function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){oe(i,r,o,a,u,"next",e)}function u(e){oe(i,r,o,a,u,"throw",e)}a(void 0)}))});return function(){return t.apply(this,arguments)}}();!function(e){var t=S(),n=P(),r=n.selection,o=j(),a=o.bgRef,c=o.selectionRefs,s=V().setMoveImage;(0,i.useEffect)((function(){var n=function(){var n=Q(K().mark((function n(){return K().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t||!r){n.next=4;break}return n.next=3,e();case 3:setTimeout((function(){var e=r.x,n=r.y,o=r.width,i=r.height;t.lineWidth=2,t.strokeStyle="#000",t.setLineDash([5,10]),t.globalCompositeOperation="source-over",t.beginPath(),t.rect(e,n,o,i),t.stroke(),t.closePath(),t.setLineDash([])}),10);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return ne.width===(null===r||void 0===r?void 0:r.width)&&ne.height===(null===r||void 0===r?void 0:r.height)&&ne.x===(null===r||void 0===r?void 0:r.x)&&ne.y===(null===r||void 0===r?void 0:r.y)||n(),function(){r&&(ne=r)}}),[r,t]);var f=(0,i.useMemo)((function(){if(r){var e=r.x,t=r.y,n=r.width,o=r.height;return n<0?(n+=4,e-=2):(n-=4,e+=2),o<0?(o+=4,t-=2):(o-=4,t+=2),{x:e,y:t,width:n,height:o}}return{width:0,height:0,x:0,y:0}}),[r]),d=function(){var e=Q(K().mark((function e(n){var o,i,u,c,l,s,d,m,h,v,b,y;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",null);case 2:if(o=f.x,i=f.y,u=f.width,c=f.height,!(l=null===t||void 0===t?void 0:t.getImageData(o,i,u,c))){e.next=23;break}if((s=document.createElement("canvas")).width=u,s.height=c,(d=document.createElement("canvas")).width=u,d.height=c,!(m=d.getContext("2d"))||!a.current){e.next=23;break}return(v=null===(h=a.current.getContext("2d"))||void 0===h?void 0:h.getImageData(o,i,u,c))&&n&&m.putImageData(v,0,0),null===(b=s.getContext("2d"))||void 0===b||b.putImageData(l,0,0),m.drawImage(s,0,0),e.next=21,new Promise((function(e){d.toBlob((function(t){t&&e(t)}))}));case 21:return y=e.sent,e.abrupt("return",y);case 23:return e.abrupt("return",null);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m=function(){if(!r)return null;var e=f.x,t=f.y,o=f.width,i=f.height;o<0?(o+=4,e-=2):(o-=4,e+=2),i<0?(i+=4,t-=2):(i-=4,t+=2);var a=te({},k,{rect:{width:o,height:i},path:[[e,t]],options:te({},n,{shape:"rect",mode:"eraser",fillColor:{r:0,g:0,b:0,a:1}})});return l.W.emit("draw",a),a},h=function(){var e=Q(K().mark((function e(){var t;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d(!0);case 2:(t=e.sent)&&navigator.clipboard.write([new ClipboardItem({"image/png":t})]).then((function(){(0,u.Am)("Copied to clipboard!",{position:"top-center",theme:"colored"})}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){var e=function(){var e=Q(K().mark((function e(t){return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"c"===t.key&&t.ctrlKey&&h(),"Delete"===t.key&&r&&m();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[a,m,t,h,d,n,r]),(0,i.useEffect)((function(){var e=function(){var e=Q(K().mark((function e(){var t,n,o,i,a,u;return K().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=10;break}return e.next=3,d();case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:n=f.x,o=f.y,i=f.width,a=f.height,(u=new FileReader).readAsDataURL(t),u.addEventListener("loadend",(function(){var e,t=null===(e=u.result)||void 0===e?void 0:e.toString();t&&(m(),s({base64:t,x:Math.min(n,n+i),y:Math.min(o,o+a)}))}));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();if(c.current){var t=c.current[0],n=c.current[1],o=c.current[2];return t.addEventListener("click",e),n.addEventListener("click",h),o.addEventListener("click",m),function(){null===t||void 0===t||t.removeEventListener("click",e),null===n||void 0===n||n.removeEventListener("click",h),null===o||void 0===o||o.removeEventListener("click",m)}}return function(){}}),[m,f,h,d,r,c,s])}(E),(0,i.useEffect)((function(){return l.W.on("your_move",(function(t){e(),f(t),setTimeout(g,100)})),function(){l.W.off("your_move")}}),[e,g,f]),(0,i.useEffect)((function(){if(ce>=p.length||!ce)E();else{var e=p[p.length-1];if("image"===e.options.shape){var t=new Image;t.src=e.img.base64,t.addEventListener("load",(function(){return w(e,t)}))}else w(e)}return function(){ce=p.length}}),[p]);var N=function(){if(b){var e=d();"select"===(null===e||void 0===e?void 0:e.options.mode)?g():e&&(h(e),l.W.emit("undo"))}},A=function(){if(b){var e=v();e&&l.W.emit("draw",e)}};return(0,i.useEffect)((function(){var e=function(e){"z"===e.key&&e.ctrlKey?N():"y"===e.key&&e.ctrlKey&&A()};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[N,A]),{handleUndo:N,handleRedo:A}},se=function(e){var t=e.bgRef,n=G(),o=w(),a=o.x,u=o.y;return(0,i.useEffect)((function(){var e,r=null===(e=t.current)||void 0===e?void 0:e.getContext("2d");if(r&&(r.fillStyle="dark"===n.mode?"#222":"#fff",r.fillRect(0,0,g,p),document.body.style.backgroundColor="dark"===n.mode?"#222":"#fff",n.lines)){r.lineWidth=1,r.strokeStyle="dark"===n.mode?"#444":"#ddd";for(var o=0;o<p;o+=25)r.beginPath(),r.moveTo(0,o),r.lineTo(r.canvas.width,o),r.stroke();for(var i=0;i<g;i+=25)r.beginPath(),r.moveTo(i,0),r.lineTo(i,r.canvas.height),r.stroke()}}),[t,n]),(0,r.jsx)(b.E.canvas,{ref:t,width:g,height:p,className:"absolute top-0 bg-zinc-100",style:{x:a,y:u}})},fe=function(e){var t=e.dragging,n=j().minimapRef,o=w(),u=x(),c=u.width,l=u.height,s=(0,i.useState)(0),f=s[0],d=s[1],m=(0,i.useState)(0),h=m[0],v=m[1],y=(0,i.useState)(!1),S=y[0],k=y[1];(0,i.useEffect)((function(){return S?function(){}:o.x.onChange(d)}),[o.x,S]),(0,i.useEffect)((function(){return S?function(){}:o.y.onChange(v)}),[o.y,S]);var E=(0,i.useRef)(null),O=(0,a.c)(0),N=(0,a.c)(0),A=(0,i.useMemo)((function(){return c>1600?7:c>1e3?10:c>600?14:20}),[c]);return(0,i.useEffect)((function(){return O.onChange((function(e){t||o.x.set(Math.floor(-e*A))})),N.onChange((function(e){t||o.y.set(Math.floor(-e*A))})),function(){O.clearListeners(),N.clearListeners()}}),[o.x,o.y,A,t,O,N]),(0,r.jsxs)("div",{className:"absolute right-10 top-10 z-30 overflow-hidden rounded-lg shadow-lg",style:{width:g/A,height:p/A},ref:E,children:[(0,r.jsx)("canvas",{ref:n,width:g,height:p,className:"h-full w-full"}),(0,r.jsx)(b.E.div,{drag:!0,dragConstraints:E,dragElastic:0,dragTransition:{power:0,timeConstant:0},onDragStart:function(){return k(!0)},onDragEnd:function(){return k(!1)},className:"absolute top-0 left-0 cursor-grab rounded-lg border-2 border-red-500",style:{width:c/A,height:l/A,x:O,y:N},animate:{x:-f/A,y:-h/A},transition:{duration:0}})]})},de=function(){var e=j(),t=e.canvasRef,n=e.bgRef,a=e.undoRef,u=e.redoRef,c=x(),s=c.width,f=c.height,d=w(),m=d.x,h=d.y,v=S(),k=(0,i.useState)(!0),E=k[0],O=k[1],N=B(E),A=N.handleEndDrawing,C=N.handleDraw,M=N.handleStartDrawing,P=N.drawing,I=N.clearOnYourMove;!function(e){var t=(0,o.bo)(),n=t.handleAddMoveToUser,r=t.handleRemoveMoveFromUser;(0,i.useEffect)((function(){var t,r="";return l.W.on("user_draw",(function(o,i){e?(t=o,r=i):n(i,o)})),function(){l.W.off("user_draw"),t&&r&&n(r,t)}}),[e,n]),(0,i.useEffect)((function(){return l.W.on("user_undo",(function(e){r(e)})),function(){l.W.off("user_undo")}}),[r])}(P);var R=le(I),W=R.handleUndo,T=R.handleRedo;return(0,i.useEffect)((function(){O(!1)}),[]),(0,i.useEffect)((function(){var e=function(e){O(e.ctrlKey)};window.addEventListener("keyup",e),window.addEventListener("keydown",e);var t=a.current,n=u.current;return null===t||void 0===t||t.addEventListener("click",W),null===n||void 0===n||n.addEventListener("click",T),function(){window.removeEventListener("keyup",e),window.removeEventListener("keydown",e),null===t||void 0===t||t.removeEventListener("click",W),null===n||void 0===n||n.removeEventListener("click",T)}}),[t,E,T,W,u,a]),(0,i.useEffect)((function(){v&&l.W.emit("joined_room")}),[v]),(0,r.jsxs)("div",{className:"relative h-full w-full overflow-hidden",children:[(0,r.jsx)(b.E.canvas,{ref:t,width:g,height:p,className:"absolute top-0 z-10 ".concat(E&&"cursor-move"),style:{x:m,y:h},drag:E,dragConstraints:{left:-(g-s),right:0,top:-(p-f),bottom:0},dragElastic:0,dragTransition:{power:0,timeConstant:0},onMouseDown:function(e){return M(e.clientX,e.clientY)},onMouseUp:A,onMouseMove:function(e){C(e.clientX,e.clientY,e.shiftKey)},onTouchStart:function(e){return M(e.changedTouches[0].clientX,e.changedTouches[0].clientY)},onTouchEnd:A,onTouchMove:function(e){return C(e.changedTouches[0].clientX,e.changedTouches[0].clientY)}}),(0,r.jsx)(se,{bgRef:n}),(0,r.jsx)(fe,{dragging:E}),(0,r.jsx)("button",{className:"absolute bottom-14 right-5 z-10 rounded-xl md:bottom-5 ".concat(E?"bg-green-500":"bg-zinc-300 text-black"," p-3 text-lg text-white"),onClick:function(){return O((function(e){return!e}))},children:(0,r.jsx)(y.Ctn,{})})]})},me=n(8933),he=n(3337),ve=function(){var e=w(),t=e.x,n=e.y,o=(0,i.useRef)({x:0,y:0}),a=(0,i.useRef)(null),u=(0,me.Z)(a),c=u.docX,s=u.docY,f=window.matchMedia("(pointer: coarse)").matches;return(0,he.Z)((function(){o.current.x===c&&o.current.y===s||f||(l.W.emit("mouse_move",E(c,t),E(s,n)),o.current={x:c,y:s})}),150),f?null:(0,r.jsxs)(b.E.div,{ref:a,className:"pointer-events-none absolute top-0 left-0 z-50 select-none transition-colors dark:text-white",animate:{x:c+15,y:s+15},transition:{duration:.05,ease:"linear"},children:[E(c,t).toFixed(0)," | ",E(s,n).toFixed(0)]})},be=function(e){var t,n,a=e.userId,u=(0,o.NW)().users,c=w(),s=(0,i.useState)(""),f=s[0],d=s[1],m=(0,i.useState)(c.x.get()),h=m[0],v=m[1],g=(0,i.useState)(c.y.get()),p=g[0],x=g[1],j=(0,i.useState)({x:-1,y:-1}),S=j[0],k=j[1];return(0,i.useEffect)((function(){l.W.on("mouse_moved",(function(e,t,n){n===a&&k({x:e,y:t})}));var e=function(e,t){e===a&&(d(t),setTimeout((function(){d("")}),3e3))};return l.W.on("new_msg",e),function(){l.W.off("mouse_moved"),l.W.off("new_msg",e)}}),[a]),(0,i.useEffect)((function(){return c.x.onChange(v)}),[c.x]),(0,i.useEffect)((function(){return c.y.onChange(x)}),[c.y]),(0,r.jsxs)(b.E.div,{className:"pointer-events-none absolute top-0 left-0 z-20 text-blue-800 ".concat(-1===S.x&&"hidden"),style:{color:null===(t=u.get(a))||void 0===t?void 0:t.color},animate:{x:S.x+h,y:S.y+p},transition:{duration:.2,ease:"linear"},children:[(0,r.jsx)(y.BKo,{className:"-rotate-90"}),f&&(0,r.jsx)("p",{className:"absolute top-full left-5 max-h-20 max-w-[15rem] overflow-hidden text-ellipsis rounded-md bg-zinc-900 p-1 px-3 text-white",children:f}),(0,r.jsx)("p",{className:"ml-2",children:(null===(n=u.get(a))||void 0===n?void 0:n.name)||"Anonymous"})]})};function ye(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ge(e){return function(e){if(Array.isArray(e))return ye(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return ye(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ye(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var pe=function(){var e=(0,o.NW)().users;return(0,r.jsx)(r.Fragment,{children:ge(e.keys()).map((function(e){return e===l.W.id?null:(0,r.jsx)(be,{userId:e},e)}))})},xe=n(8193);function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){we(e,t,n[t])}))}return e}var Se=function(){var e=j().canvasRef,t=w(),n=t.x,o=t.y,u=V(),c=u.moveImage,s=u.setMoveImage,f=(0,a.c)(c.x||50),d=(0,a.c)(c.y||50);(0,i.useEffect)((function(){c.x?f.set(c.x):f.set(50),c.y?d.set(c.y):d.set(50)}),[f,d,c.x,c.y]);return c.base64?(0,r.jsxs)(b.E.div,{drag:!0,dragConstraints:e,dragElastic:0,dragTransition:{power:.03,timeConstant:50},className:"absolute top-0 z-20 cursor-grab",style:{x:f,y:d},children:[(0,r.jsxs)("div",{className:"absolute bottom-full mb-2 flex gap-3",children:[(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",onClick:function(){var e=[E(f.get(),n),E(d.get(),o)],t=e[0],r=e[1],i=je({},k,{img:{base64:c.base64},path:[[t,r]],options:je({},k.options,{selection:null,shape:"image"})});l.W.emit("draw",i),s({base64:""}),f.set(50),d.set(50)},children:(0,r.jsx)(xe.bzc,{})}),(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",onClick:function(){return s({base64:""})},children:(0,r.jsx)(xe.oHP,{})})]}),(0,r.jsx)("img",{className:"pointer-events-none",alt:"image to place",src:c.base64})]}):null},ke=n(6893),Ee=function(){var e,t,n=P().selection,o=j().selectionRefs;if(n){var i=n.x,a=n.y,u=n.width,c=n.height;e=Math.min(a,a+c)-40,t=Math.min(i,i+u)}else t=-40,e=-40;return(0,r.jsxs)("div",{className:"absolute top-0 left-0 z-50 flex items-center justify-center gap-2",style:{top:e,left:t},children:[(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:function(e){e&&o.current&&(o.current[0]=e)},children:(0,r.jsx)(y.Ctn,{})}),(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:function(e){e&&o.current&&(o.current[1]=e)},children:(0,r.jsx)(ke.C3L,{})}),(0,r.jsx)("button",{className:"rounded-full bg-gray-200 p-2",ref:function(e){e&&o.current&&(o.current[2]=e)},children:(0,r.jsx)(xe.VPh,{})})]})},Oe=n(9583),Ne=n(1515),Ae=n(2348),Ce=function(){var e=(0,i.useState)(""),t=e[0],n=e[1];return(0,r.jsxs)("form",{className:"flex w-full items-center gap-2",onSubmit:function(e){e.preventDefault(),l.W.emit("send_msg",t),n("")},children:[(0,r.jsx)("input",{className:"w-full rounded-xl border border-zinc-300 p-5 py-1",value:t,onChange:function(e){return n(e.target.value)}}),(0,r.jsx)("button",{className:"btn-icon h-full w-10 bg-black",type:"submit",children:(0,r.jsx)(xe.gYb,{})})]})},Me=function(e){var t=e.userId,n=e.msg,o=e.username,i=e.color,a=l.W.id===t;return(0,r.jsxs)("div",{className:"my-2 flex gap-2 text-clip ".concat(a&&"justify-end text-right"),children:[!a&&(0,r.jsx)("h5",{style:{color:i},className:"font-bold",children:o}),(0,r.jsx)("p",{style:{wordBreak:"break-all"},children:n})]})};function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pe(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var We=function(){var e=(0,o.NW)(),t=(0,i.useRef)(null),n=(0,i.useState)(!1),a=n[0],u=n[1],c=(0,i.useState)(!1),s=c[0],f=c[1],d=Re((0,Ne.Z)([]),2),m=d[0],h=d[1];return(0,i.useEffect)((function(){var n=function(n,r){var o,i,a=e.users.get(n);h.push({userId:n,msg:r,id:m.length+1,username:(null===a||void 0===a?void 0:a.name)||"Anonymous",color:(null===a||void 0===a?void 0:a.color)||"#000"}),null===(o=t.current)||void 0===o||o.scroll({top:null===(i=t.current)||void 0===i?void 0:i.scrollHeight}),s||u(!0)};return l.W.on("new_msg",n),function(){l.W.off("new_msg",n)}}),[h,m,s,e.users]),(0,r.jsxs)(b.E.div,{className:"absolute bottom-0 z-50 flex h-[300px] w-full flex-col overflow-hidden rounded-t-md sm:left-36 sm:w-[30rem]",animate:{y:s?0:260},transition:{ease:Ae.n,duration:.2},children:[(0,r.jsxs)("button",{className:"flex w-full cursor-pointer items-center justify-between bg-zinc-900 py-2 px-10 font-semibold text-white",onClick:function(){f((function(e){return!e})),u(!1)},children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(y.Nm2,{className:"mt-[-2px]"}),"Chat",a&&(0,r.jsx)("p",{className:"rounded-md bg-green-500 px-1 font-semibold text-green-900",children:"New!"})]}),(0,r.jsx)(b.E.div,{animate:{rotate:s?0:180},transition:{ease:Ae.n,duration:.2},children:(0,r.jsx)(Oe.RiI,{})})]}),(0,r.jsxs)("div",{className:"flex flex-1 flex-col justify-between bg-white p-3",children:[(0,r.jsx)("div",{className:"h-[190px] overflow-y-scroll pr-2",ref:t,children:m.map((function(e){return(0,r.jsx)(Me,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ie(e,t,n[t])}))}return e}({},e),e.id)}))}),(0,r.jsx)(Ce,{})]})]})},Te=n(1163),Le=n(1513),De=n(100),_e=function(){var e=(0,o.u4)(),t=(0,Le.d)().openModal,n=(0,i.useState)(""),a=n[0],u=n[1],c=(0,Te.useRouter)(),s=(c.query.roomId||"").toString();(0,i.useEffect)((function(){if(s)return l.W.emit("check_room",s),l.W.on("room_exists",(function(e){e||c.push("/")})),function(){l.W.off("room_exists")}}),[s,c]),(0,i.useEffect)((function(){var n=function(n,o){o?(c.push("/"),t((0,r.jsx)(De.Z,{id:n}))):e(n)};return l.W.on("joined",n),function(){l.W.off("joined",n)}}),[t,c,e]);return(0,r.jsxs)("form",{className:"my-24 flex flex-col items-center",onSubmit:function(e){e.preventDefault(),l.W.emit("join_room",s,a)},children:[(0,r.jsx)("h1",{className:"text-5xl font-extrabold leading-tight sm:text-extra",children:"Collabio"}),(0,r.jsx)("h3",{className:"text-xl sm:text-2xl",children:"Real-time whiteboard"}),(0,r.jsxs)("div",{className:"mt-10 mb-3 flex flex-col gap-2",children:[(0,r.jsx)("label",{className:"self-start font-bold leading-tight",children:"Enter your name"}),(0,r.jsx)("input",{className:"rounded-xl border p-5 py-1",id:"room-id",placeholder:"Username...",value:a,onChange:function(e){return u(e.target.value.slice(0,15))}})]}),(0,r.jsx)("button",{className:"btn",type:"submit",children:"Enter room"})]})},Ue=n(3854),ze=n(3990),Xe=n(1649),Fe=function(){var e=(0,o.NW)().id,t=(0,Le.d)().closeModal,n=(0,i.useState)(""),a=n[0],u=n[1];(0,i.useEffect)((function(){return u(window.location.href)}),[]);return(0,r.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10 pt-5",children:[(0,r.jsx)("button",{onClick:t,className:"absolute top-5 right-5",children:(0,r.jsx)(xe.oHP,{})}),(0,r.jsx)("h2",{className:"text-2xl font-bold",children:"Invite"}),(0,r.jsxs)("h3",{children:["Room id: ",(0,r.jsx)("p",{className:"inline font-bold",children:e})]}),(0,r.jsxs)("div",{className:"relative mt-2",children:[(0,r.jsx)("input",{type:"text",value:a,readOnly:!0,className:"input sm:w-96"}),(0,r.jsx)("button",{className:"btn absolute right-0 h-full",onClick:function(){return navigator.clipboard.writeText(a)},children:"Copy"})]})]})},Ye=n(471),Ze=function(){var e=(0,Le.d)().closeModal,t=function(){var e=(0,N.Zl)(H);return function(t,n){e({mode:t,lines:n})}}(),n=G();(0,i.useEffect)((function(){return e}),[n,e]);var o=function(e,t,n){var r=null===e||void 0===e?void 0:e.getContext("2d");if(r&&(r.fillStyle="dark"===t?"#222":"#fff",r.fillRect(0,0,r.canvas.width,r.canvas.height),n)){r.lineWidth=1,r.strokeStyle="dark"===t?"#444":"#ddd";for(var o=0;o<r.canvas.height;o+=10)r.beginPath(),r.moveTo(0,o),r.lineTo(r.canvas.width,o),r.stroke();for(var i=0;i<r.canvas.width;i+=10)r.beginPath(),r.moveTo(i,0),r.lineTo(i,r.canvas.height),r.stroke()}};return(0,r.jsxs)("div",{className:"relative flex flex-col items-center rounded-md bg-white p-10",children:[(0,r.jsx)("button",{onClick:e,className:"absolute top-5 right-5",children:(0,r.jsx)(xe.oHP,{})}),(0,r.jsx)("h2",{className:"mb-4 text-2xl font-bold",children:"Choose background"}),(0,r.jsxs)("div",{className:"grid gap-5 sm:grid-cols-2",children:[(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:function(){return t("dark",!0)},ref:function(e){return o(e,"dark",!0)}}),(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:function(){return t("light",!0)},ref:function(e){return o(e,"light",!0)}}),(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:function(){return t("dark",!1)},ref:function(e){return o(e,"dark",!1)}}),(0,r.jsx)("canvas",{className:"h-48 w-64 cursor-pointer rounded-md border-2",tabIndex:0,width:256,height:192,onClick:function(){return t("light",!1)},ref:function(e){return o(e,"light",!1)}})]})]})},$e=function(){var e=(0,Le.d)().openModal;return(0,r.jsx)("button",{className:"btn-icon",onClick:function(){return e((0,r.jsx)(Ze,{}))},children:(0,r.jsx)(Ye.bTn,{})})},Be=n(1190),Je=n(5907),Ke=n(9293),He={from:{y:-30,opacity:0,transition:{ease:Ae.n,duration:.2}},to:{y:0,opacity:1,transition:{ease:Ae.n,duration:.2}}};function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ve(e,t,n[t])}))}return e}function Qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ge(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var et=function(){var e=Qe(I(),2),t=e[0],n=e[1],o=(0,i.useRef)(null),a=(0,i.useState)(!1),u=a[0],c=a[1];return(0,Ke.Z)(o,(function(){return c(!1)})),(0,r.jsxs)("div",{className:"relative flex items-center",ref:o,children:[(0,r.jsx)("button",{className:"btn-icon",onClick:function(){return c(!u)},disabled:"select"===t.mode,children:(0,r.jsx)(y.woE,{})}),(0,r.jsx)(Be.M,{children:u&&(0,r.jsxs)(b.E.div,{className:"absolute left-10 mt-24 sm:left-14",variants:He,initial:"from",animate:"to",exit:"from",children:[(0,r.jsx)("h2",{className:"ml-3 font-semibold text-black dark:text-white",children:"Line color"}),(0,r.jsx)(Je.Jg,{color:t.lineColor,onChange:function(e){n(qe({},t,{lineColor:e}))},className:"mb-5"}),(0,r.jsx)("h2",{className:"ml-3 font-semibold text-black dark:text-white",children:"Fill color"}),(0,r.jsx)(Je.Jg,{color:t.fillColor,onChange:function(e){n(qe({},t,{fillColor:e}))}})]})})]})},tt=function(){var e=j(),t=e.redoRef,n=e.undoRef,i=(0,o.av)().myMoves,a=(0,N.sJ)(W);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"btn-icon text-xl",ref:t,disabled:!a.length,children:(0,r.jsx)(Oe.WLu,{})}),(0,r.jsx)("button",{className:"btn-icon text-xl",ref:n,disabled:!i.length,children:(0,r.jsx)(Oe.wXW,{})})]})},nt=n(6770),rt=n.n(nt),ot=function(e,t){rt().imageFileResizer(e,700,700,"WEBP",100,0,(function(e){t(e.toString())}),"base64")},it=function(){var e=V().setMoveImage;(0,i.useEffect)((function(){var t=function(t){var n,r=null===(n=t.clipboardData)||void 0===n?void 0:n.items;if(r){var o=!0,i=!1,a=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;if(l.type.includes("image")){var s=l.getAsFile();s&&ot(s,(function(t){return e({base64:t})}))}}}catch(f){i=!0,a=f}finally{try{o||null==c.return||c.return()}finally{if(i)throw a}}}};return document.addEventListener("paste",t),function(){document.removeEventListener("paste",t)}}),[e]);return(0,r.jsx)("button",{className:"btn-icon text-xl",onClick:function(){var t=document.createElement("input");t.type="file",t.accept="image/*",t.click(),t.addEventListener("change",(function(){if(t&&t.files){var n=t.files[0];ot(n,(function(t){return e({base64:t})}))}}))},children:(0,r.jsx)(y.vGR,{})})};function at(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ct(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return at(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return at(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var lt=function(){var e=ct(I(),2),t=e[0],n=e[1],o=(0,i.useRef)(null),a=(0,i.useState)(!1),u=a[0],c=a[1];return(0,Ke.Z)(o,(function(){return c(!1)})),(0,r.jsxs)("div",{className:"relative flex items-center",ref:o,children:[(0,r.jsx)("button",{className:"btn-icon text-xl",onClick:function(){return c(!u)},disabled:"select"===t.mode,children:(0,r.jsx)(y.S2O,{})}),(0,r.jsx)(Be.M,{children:u&&(0,r.jsx)(b.E.div,{className:"absolute top-[6px] left-14 w-36",variants:He,initial:"from",animate:"to",exit:"from",children:(0,r.jsx)("input",{type:"range",min:1,max:20,value:t.lineWidth,onChange:function(e){return n((function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ut(e,t,n[t])}))}return e}({},t,{lineWidth:parseInt(e.target.value,10)})}))},className:"h-4 w-full cursor-pointer appearance-none rounded-lg bg-gray-200"})})})]})};function st(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ft(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ft(e,t,n[t])}))}return e}function mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return st(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return st(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ht=function(){var e=mt(I(),2),t=e[0],n=e[1],o=R().clearSelection;return(0,i.useEffect)((function(){o()}),[t.mode]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{className:"btn-icon text-xl ".concat("draw"===t.mode&&"bg-green-400"),onClick:function(){n((function(e){return dt({},e,{mode:"draw"})}))},children:(0,r.jsx)(y.Aac,{})}),(0,r.jsx)("button",{className:"btn-icon text-xl ".concat("eraser"===t.mode&&"bg-green-400"),onClick:function(){n((function(e){return dt({},e,{mode:"eraser"})}))},children:(0,r.jsx)(Oe.arg,{})}),(0,r.jsx)("button",{className:"btn-icon text-2xl ".concat("select"===t.mode&&"bg-green-400"),onClick:function(){n((function(e){return dt({},e,{mode:"select"})}))},children:(0,r.jsx)(xe.AJi,{})})]})},vt=n(7516);function bt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);a=!0);}catch(c){u=!0,o=c}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(!e)return;if("string"===typeof e)return bt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return bt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var pt=function(){var e=gt(I(),2),t=e[0],n=e[1],o=(0,i.useRef)(null),a=(0,i.useState)(!1),u=a[0],c=a[1];(0,Ke.Z)(o,(function(){return c(!1)}));var l=function(e){n((function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){yt(e,t,n[t])}))}return e}({},t,{shape:e})})),c(!1)};return(0,r.jsxs)("div",{className:"relative flex items-center",ref:o,children:[(0,r.jsxs)("button",{className:"btn-icon text-2xl",disabled:"select"===t.mode,onClick:function(){return c((function(e){return!e}))},children:["circle"===t.shape&&(0,r.jsx)(y.b9R,{}),"rect"===t.shape&&(0,r.jsx)(vt.v3P,{}),"line"===t.shape&&(0,r.jsx)(Ye.slm,{})]}),(0,r.jsx)(Be.M,{children:u&&(0,r.jsxs)(b.E.div,{className:"absolute left-14 z-10 flex gap-1 rounded-lg border bg-zinc-900 p-2 md:border-0",variants:He,initial:"from",animate:"to",exit:"from",children:[(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:function(){return l("line")},children:(0,r.jsx)(Ye.slm,{})}),(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:function(){return l("rect")},children:(0,r.jsx)(vt.v3P,{})}),(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:function(){return l("circle")},children:(0,r.jsx)(y.b9R,{})})]})})]})},xt=function(){var e=j(),t=e.canvasRef,n=e.bgRef,o=(0,Le.d)().openModal,a=x().width,u=(0,i.useState)(!1),c=u[0],l=u[1],s=(0,Te.useRouter)();(0,i.useEffect)((function(){l(a>=1024)}),[a]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(b.E.button,{className:"btn-icon absolute bottom-1/2 -left-2 z-50 h-10 w-10 rounded-full bg-black text-2xl transition-none lg:hidden",animate:{rotate:c?0:180},transition:{duration:.2,ease:Ae.n},onClick:function(){return l(!c)},children:(0,r.jsx)(ke.Tfp,{})}),(0,r.jsxs)(b.E.div,{className:"absolute left-10 top-[50%] z-50 grid grid-cols-2 items-center gap-5 rounded-lg bg-zinc-900 p-5 text-white 2xl:grid-cols-1",animate:{x:c?0:-160,y:"-50%"},transition:{duration:.2,ease:Ae.n},children:[(0,r.jsx)(tt,{}),(0,r.jsx)("div",{className:"h-px w-full bg-white 2xl:hidden"}),(0,r.jsx)("div",{className:"h-px w-full bg-white"}),(0,r.jsx)(pt,{}),(0,r.jsx)(et,{}),(0,r.jsx)(lt,{}),(0,r.jsx)(ht,{}),(0,r.jsx)(it,{}),(0,r.jsx)("div",{className:"2xl:hidden"}),(0,r.jsx)("div",{className:"h-px w-full bg-white 2xl:hidden"}),(0,r.jsx)("div",{className:"h-px w-full bg-white"}),(0,r.jsx)($e,{}),(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:function(){return o((0,r.jsx)(Fe,{}))},children:(0,r.jsx)(Xe.qSo,{})}),(0,r.jsx)("button",{className:"btn-icon text-2xl",onClick:function(){var e=document.createElement("canvas");e.width=g,e.height=p;var r=e.getContext("2d");r&&t.current&&n.current&&(r.drawImage(n.current,0,0),r.drawImage(t.current,0,0));var o=document.createElement("a");o.href=e.toDataURL("image/png"),o.download="canvas.png",o.click()},children:(0,r.jsx)(Ue.yFZ,{})}),(0,r.jsx)("button",{className:"btn-icon text-xl",onClick:function(){return s.push("/")},children:(0,r.jsx)(ze.T$9,{})})]})]})};function wt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jt(e){return function(e){if(Array.isArray(e))return wt(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"===typeof e)return wt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var St=function(){var e=(0,o.NW)().users;return(0,r.jsx)("div",{className:"pointer-events-none absolute z-30 flex p-5",children:jt(e.keys()).map((function(t,n){var o,i;return(0,r.jsx)("div",{className:"flex h-5 w-5 select-none items-center justify-center rounded-full text-xs text-white md:h-8 md:w-8 md:text-base lg:h-12 lg:w-12",style:{backgroundColor:(null===(o=e.get(t))||void 0===o?void 0:o.color)||"black",marginLeft:0!==n?"-0.5rem":0},children:(null===(i=e.get(t))||void 0===i?void 0:i.name.split("")[0])||"A"},t)}))})},kt=function(){return(0,o.NW)().id?(0,r.jsx)(v,{children:(0,r.jsxs)("div",{className:"relative h-full w-full overflow-hidden",children:[(0,r.jsx)(St,{}),(0,r.jsx)(xt,{}),(0,r.jsx)(Ee,{}),(0,r.jsx)(Se,{}),(0,r.jsx)(de,{}),(0,r.jsx)(ve,{}),(0,r.jsx)(pe,{}),(0,r.jsx)(We,{})]})}):(0,r.jsx)(_e,{})},Et=function(){return(0,r.jsx)(kt,{})}}},function(e){e.O(0,[617,866,609,556,445,955,13,874,871,186,774,888,179],(function(){return t=1040,e(e.s=t);var t}));var t=e.O();_N_E=t}]);